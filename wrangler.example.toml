name = "twitter-loyalty-bot"
main = "src/index.js"
compatibility_date = "2024-11-23"
compatibility_flags = ["nodejs_compat"]

# ============================================
# SUPPORTED ENGAGEMENT TYPES
# ============================================
# This bot rewards users for these Twitter interactions:
#
# BASIC TIER ($100/mo):
#   - tweet_mention: User @mentions your brand
#   - tweet_reply: User replies to your tweets
#
# PRO TIER ($5,000/mo):
#   - tweet_like: User likes your tweets
#   - tweet_retweet: User retweets your content
#
# Configure rewards for each event type in Partner Portal
# ============================================

# Custom domain configuration (Optional)
# [[routes]]
# pattern = "x-bot.your-domain.com/*"
# zone_name = "your-domain.com"

# Service bindings (Optional - for Loyalteez internal use)
# These enable faster worker-to-worker communication
# [[services]]
# binding = "EVENT_HANDLER"
# service = "loyalteez-event-handler"

# Key-value storage for deduplication
# Create with: npx wrangler kv:namespace create TWITTER_BOT_KV
[[kv_namespaces]]
binding = "TWITTER_BOT_KV"
id = "your_kv_namespace_id"

# ============================================
# SCHEDULED POLLING
# ============================================
# Polls Twitter API at scheduled intervals for engagements
#
# Recommended cron schedules by tier:
#   Free tier:  "0 12 * * *"     (daily at noon UTC - conserve 100 tweets/mo)
#   Basic tier: "*/15 * * * *"   (every 15 mins)
#   Pro tier:   "*/5 * * * *"    (every 5 mins)
#
[triggers]
crons = ["0 12 * * *"]

[vars]
# Loyalteez Brand ID (Your wallet address from Partner Portal)
BRAND_ID = "0x_your_brand_wallet_address"

# API URL for Loyalteez Event Handler
LOYALTEEZ_API_URL = "https://api.loyalteez.app"

# Supabase connection (for reading Twitter handle from Partner Portal)
SUPABASE_URL = "https://xcyhefjogmgttegqhhyi.supabase.co"

# ============================================
# SECRETS - Set via CLI (NEVER commit to git!)
# ============================================
# npx wrangler secret put TWITTER_BEARER_TOKEN
# npx wrangler secret put SUPABASE_PUBLISH_KEY
#
# TWITTER_BEARER_TOKEN: 
#   Get from Twitter Developer Portal → Keys and Tokens → Bearer Token
#   Required for all engagement tracking
#
# SUPABASE_PUBLISH_KEY: 
#   Get from Loyalteez team (browser-safe key for RLS)
#   Required to read configuration from Partner Portal
# ============================================
